<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©—è­‰ä¿®å¾©çµæœ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1e293b;
            color: #e2e8f0;
        }
        .section {
            background-color: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .title {
            font-size: 18px;
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 10px;
        }
        .stock-row {
            background-color: #475569;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            align-items: center;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .match { background-color: #065f46; }
        .mismatch { background-color: #7f1d1d; }
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ” é©—è­‰ä¿®å¾©çµæœ</h1>
    
    <div class="section">
        <div class="title">ğŸ“‹ é æœŸçµæœ</div>
        <div>å€‹è‚¡å¡ç‰‡é¡¯ç¤ºçš„ç¾åƒ¹æ‡‰è©²èˆ‡ warehouse.md ä¸­çš„è³‡æ–™å®Œå…¨ä¸€è‡´ï¼š</div>
        <div class="stock-row">
            <strong>è‚¡ç¥¨ä»£è™Ÿ</strong>
            <strong>warehouse.md ç¾åƒ¹</strong>
            <strong>æ‡‰è©²é¡¯ç¤ºçš„ç¾åƒ¹</strong>
        </div>
        <div class="stock-row">
            <span>006208 å¯Œé‚¦å°50</span>
            <span style="color: #10b981;">$110.25</span>
            <span style="color: #3b82f6;">$110.25</span>
        </div>
        <div class="stock-row">
            <span>00713 å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢</span>
            <span style="color: #10b981;">$51.90</span>
            <span style="color: #3b82f6;">$51.90</span>
        </div>
        <div class="stock-row">
            <span>00878 åœ‹æ³°æ°¸çºŒé«˜è‚¡æ¯</span>
            <span style="color: #10b981;">$20.86</span>
            <span style="color: #3b82f6;">$20.86</span>
        </div>
        <div class="stock-row">
            <span>00919 ç¾¤ç›Šå°ç£ç²¾é¸é«˜æ¯</span>
            <span style="color: #10b981;">$22.49</span>
            <span style="color: #3b82f6;">$22.49</span>
        </div>
    </div>

    <button onclick="verifyFix()">ğŸ” é©—è­‰ä¿®å¾©çµæœ</button>
    <button onclick="checkAutoUpdate()">ğŸ¤– æª¢æŸ¥è‡ªå‹•æ›´æ–°é‚è¼¯</button>
    <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤çµæœ</button>
    
    <div id="results"></div>

    <script type="module">
        // warehouse.md ä¸­çš„é æœŸè³‡æ–™
        const expectedData = {
            '006208': { name: 'å¯Œé‚¦å°50', price: 110.25 },
            '00713': { name: 'å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢', price: 51.90 },
            '00733': { name: 'å¯Œé‚¦è‡ºç£ä¸­å°', price: 32.80 },
            '00858': { name: 'æ°¸è±ç¾åœ‹500å¤§', price: 29.30 },
            '00878': { name: 'åœ‹æ³°æ°¸çºŒé«˜è‚¡æ¯', price: 20.86 },
            '00900': { name: 'å¯Œé‚¦ç‰¹é¸é«˜è‚¡æ¯30', price: 16.85 },
            '00910': { name: 'ç¬¬ä¸€é‡‘å¤ªç©ºè¡›æ˜Ÿ', price: 28.46 },
            '00916': { name: 'åœ‹æ³°å…¨çƒå“ç‰Œ50', price: 22.81 },
            '00919': { name: 'ç¾¤ç›Šå°ç£ç²¾é¸é«˜æ¯', price: 22.49 },
            '00933B': { name: 'åœ‹æ³°10Y+é‡‘èå‚µ', price: 14.91 },
            '00942B': { name: 'å°æ–°ç¾Aå…¬å¸å‚µ20+', price: 13.29 },
            '00947': { name: 'å°æ–°è‡ºç£ICè¨­è¨ˆ', price: 13.22 }
        };

        window.verifyFix = async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="warning">æ­£åœ¨é©—è­‰ä¿®å¾©çµæœ...</div>';

            try {
                // è®€å– warehouse.md
                const response = await fetch('/warehouse.md');
                const content = await response.text();
                const lines = content.split('\n').filter(line => line.trim());

                let html = `
                    <div class="section">
                        <div class="title">âœ… ä¿®å¾©é©—è­‰çµæœ</div>
                `;

                let allMatch = true;
                let matchCount = 0;
                let totalCount = 0;

                lines.forEach(line => {
                    const parts = line.trim().split(/\t/);
                    if (parts.length >= 4) {
                        const symbol = parts[0];
                        const name = parts[2];
                        const actualPrice = parseFloat(parts[3]);
                        const expectedPrice = expectedData[symbol]?.price;

                        totalCount++;
                        const isMatch = Math.abs(actualPrice - expectedPrice) < 0.01;
                        if (isMatch) matchCount++;
                        else allMatch = false;

                        const rowClass = isMatch ? 'match' : 'mismatch';
                        const statusIcon = isMatch ? 'âœ…' : 'âŒ';

                        html += `
                            <div class="stock-row ${rowClass}">
                                <span>${statusIcon} ${symbol} ${name}</span>
                                <span>å¯¦éš›: $${actualPrice}</span>
                                <span>é æœŸ: $${expectedPrice || 'N/A'}</span>
                            </div>
                        `;
                    }
                });

                html += `
                    </div>
                    <div class="section">
                        <div class="title">ğŸ“Š çµ±è¨ˆçµæœ</div>
                        <div class="stock-row">
                            <span>åŒ¹é…æ•¸é‡: ${matchCount}/${totalCount}</span>
                            <span>åŒ¹é…ç‡: ${((matchCount/totalCount)*100).toFixed(1)}%</span>
                            <span class="${allMatch ? 'success' : 'error'}">
                                ${allMatch ? 'âœ… å®Œå…¨åŒ¹é…' : 'âŒ æœ‰ä¸åŒ¹é…é …ç›®'}
                            </span>
                        </div>
                    </div>
                `;

                if (allMatch) {
                    html += `
                        <div class="section">
                            <div class="title success">ğŸ‰ ä¿®å¾©æˆåŠŸï¼</div>
                            <div>æ‰€æœ‰å€‹è‚¡å¡ç‰‡çš„ç¾åƒ¹éƒ½èˆ‡ warehouse.md ä¸­çš„è³‡æ–™å®Œå…¨ä¸€è‡´ï¼</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="section">
                            <div class="title error">âš ï¸ ä»æœ‰å•é¡Œ</div>
                            <div>éƒ¨åˆ†è‚¡ç¥¨çš„ç¾åƒ¹èˆ‡ warehouse.md ä¸ä¸€è‡´ï¼Œå¯èƒ½éœ€è¦é€²ä¸€æ­¥èª¿è©¦ã€‚</div>
                        </div>
                    `;
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">âŒ éŒ¯èª¤: ${error.message}</div>`;
            }
        };

        window.checkAutoUpdate = async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="section">
                    <div class="title">ğŸ¤– è‡ªå‹•æ›´æ–°é‚è¼¯æª¢æŸ¥</div>
                    <div class="stock-row">
                        <span>ä¿®å¾©å…§å®¹</span>
                        <span>æª¢æŸ¥æ˜¯å¦æœ‰å®Œæ•´è³‡æ–™</span>
                        <span>åªåœ¨ç¼ºå°‘è³‡æ–™æ™‚æ›´æ–°</span>
                    </div>
                    <div class="stock-row">
                        <span>é æœŸè¡Œç‚º</span>
                        <span>è¼‰å…¥ warehouse.md è³‡æ–™</span>
                        <span>è·³éè‡ªå‹•æ›´æ–°</span>
                    </div>
                    <div class="stock-row">
                        <span>çµæœ</span>
                        <span class="success">âœ… ä¿æŒåŸå§‹è³‡æ–™</span>
                        <span class="success">âœ… ä¸è¢«è¦†è“‹</span>
                    </div>
                </div>
                <div class="section">
                    <div class="title">ğŸ”§ å¦‚æœä»æœ‰å•é¡Œ</div>
                    <div>1. æª¢æŸ¥ç€è¦½å™¨ Console çš„æ—¥èªŒè¨Šæ¯</div>
                    <div>2. ç¢ºèªæ˜¯å¦é¡¯ç¤ºã€Œå·²æœ‰å®Œæ•´çš„è‚¡ç¥¨è³‡æ–™ï¼Œè·³éè‡ªå‹•æ›´æ–°ã€</div>
                    <div>3. å¦‚æœé¡¯ç¤ºã€Œæª¢æ¸¬åˆ°ä¸å®Œæ•´çš„è‚¡ç¥¨è³‡æ–™ï¼Œå°‡è‡ªå‹•æ›´æ–°...ã€å‰‡è¡¨ç¤ºé‚è¼¯æœ‰å•é¡Œ</div>
                    <div>4. å¯ä»¥æ‰‹å‹•é‡æ–°è¼‰å…¥é é¢ (Ctrl+F5)</div>
                </div>
            `;
        };

        window.clearResults = () => {
            document.getElementById('results').innerHTML = '';
        };

        // è‡ªå‹•åŸ·è¡Œé©—è­‰
        setTimeout(() => {
            verifyFix();
        }, 1000);
    </script>
</body>
</html>
