# 🚀 Warehouse.md 自動更新設定指南

## 概述

現在您可以設定**真正的自動更新**，讓 warehouse.md 檔案在股票資料更新時自動更新，無需手動下載和覆蓋！

## 🔧 設定步驟

### 步驟 1: 啟動自動更新服務

#### 方法 A: 使用啟動腳本 (推薦)

**macOS/Linux:**
```bash
./start-auto-update.sh
```

**Windows:**
```cmd
start-auto-update.bat
```

#### 方法 B: 手動啟動

```bash
# 進入 server 目錄
cd server

# 安裝依賴
npm install

# 啟動服務
npm start
```

### 步驟 2: 驗證服務運行

1. 看到以下訊息表示服務啟動成功：
```
🚀 Warehouse Updater Service 運行在 http://localhost:3001
📁 監控檔案: /Users/eugenefang/Desktop/code/inventment/warehouse.md
```

2. 在瀏覽器中訪問 http://localhost:3001/api/health 檢查服務狀態

### 步驟 3: 啟動主應用程式

```bash
npm run dev
```

## 🎯 自動更新流程

啟動服務後，完整的自動更新流程如下：

1. **✅ 讀取 warehouse.md** → 檢測不完整的股票資料
2. **✅ 爬蟲最新資訊** → 獲取完整的股票資訊  
3. **✅ 自動更新 warehouse.md** → 直接更新檔案 (無需手動操作)
4. **✅ 自動重新載入** → 3秒後自動重新載入頁面
5. **✅ 更新卡片** → 顯示最新的股票資訊

## 🔍 功能特色

### 真正的自動更新
- ✅ **無需手動下載**：系統自動更新 warehouse.md 檔案
- ✅ **無需手動覆蓋**：直接修改原檔案
- ✅ **自動重新載入**：更新完成後自動刷新頁面

### 安全備份機制
- 📁 **自動備份**：每次更新前自動備份原檔案
- 🕐 **時間戳記**：備份檔案包含時間戳記，如 `warehouse.backup.2025-06-16T19-45-00-000Z.md`
- 📋 **備份列表**：可查看所有備份檔案

### 智能回退機制
- 🔄 **自動檢測**：檢測後端服務是否可用
- 🛡️ **優雅降級**：服務不可用時自動回退到手動下載方式
- ⚠️ **清晰提示**：明確告知用戶當前使用的更新方式

## 📊 狀態指示

### 服務可用時
```
✅ 自動更新服務可用 - warehouse.md 可以自動更新
🚀 自動更新完成！已更新 X 檔股票資料並自動更新 warehouse.md
```

### 服務不可用時
```
⚠️ 自動更新服務不可用 - 將使用手動下載方式
🚀 自動更新完成！已更新 X 檔股票資料，請手動更新 warehouse.md 檔案
```

## 🛠️ 技術架構

### 後端服務 (Node.js + Express)
- **端口**: 3001
- **API 端點**:
  - `GET /api/health` - 健康檢查
  - `GET /api/warehouse` - 讀取 warehouse.md
  - `POST /api/warehouse/update` - 更新 warehouse.md
  - `GET /api/warehouse/backups` - 獲取備份列表

### 前端整合
- **自動檢測**: 啟動時檢查後端服務可用性
- **智能更新**: 根據服務狀態選擇更新方式
- **即時反饋**: 提供清晰的狀態提示

## 🔧 故障排除

### 問題 1: 服務啟動失敗
**解決方案**:
1. 確認 Node.js 已安裝: `node --version`
2. 確認端口 3001 未被占用
3. 檢查檔案權限

### 問題 2: 自動更新失敗
**解決方案**:
1. 檢查後端服務是否運行
2. 確認 warehouse.md 檔案權限
3. 查看 Console 錯誤訊息

### 問題 3: 備份檔案過多
**解決方案**:
- 定期清理舊的備份檔案
- 備份檔案命名格式: `warehouse.backup.{timestamp}.md`

## 🎉 使用體驗

### 完全自動化
當您新增股票到 warehouse.md (如 `00921   222`) 並進入應用程式時：

1. **自動檢測**: 系統檢測到 00921 缺少完整資訊
2. **自動爬取**: 獲取兆豐龍頭等權重的完整資料
3. **自動更新**: warehouse.md 自動更新為完整格式
4. **自動重新載入**: 頁面自動刷新顯示最新資料

### 零手動操作
- ❌ 不需要下載檔案
- ❌ 不需要手動覆蓋
- ❌ 不需要手動重新載入
- ✅ 完全自動化流程

## 📝 注意事項

1. **服務依賴**: 自動更新需要後端服務運行
2. **端口占用**: 確保 3001 端口可用
3. **檔案權限**: 確保有 warehouse.md 的寫入權限
4. **備份管理**: 定期清理備份檔案

---

**現在您可以享受完全自動化的 warehouse.md 更新體驗！** 🎉✨
