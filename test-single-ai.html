<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–®ä¸€AIæ¨¡å‹æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .container {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background-color: #4CAF50; }
        .error { background-color: #f44336; }
        .warning { background-color: #ff9800; }
        .info { background-color: #2196F3; }
        pre {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤– å–®ä¸€AIæ¨¡å‹æ¸¬è©¦å·¥å…·</h1>
    
    <div class="container">
        <h2>ğŸ“‹ å¯ç”¨çš„AIæ¨¡å‹</h2>
        <div id="models-list">è¼‰å…¥ä¸­...</div>
    </div>

    <div class="container">
        <h2>ğŸ§ª æ¸¬è©¦æ§åˆ¶</h2>
        <button onclick="testAllModelsSequentially()">ä¾åºæ¸¬è©¦æ‰€æœ‰æ¨¡å‹</button>
        <button onclick="clearResults()">æ¸…é™¤çµæœ</button>
    </div>

    <div class="container">
        <h2>ğŸ“Š æ¸¬è©¦çµæœ</h2>
        <div id="results"></div>
    </div>

    <script>
        let availableModels = [];
        let isTestingInProgress = false;

        // è¼‰å…¥AIæ¨¡å‹é…ç½®
        async function loadAIModels() {
            try {
                const response = await fetch('/api.md');
                const content = await response.text();
                const models = [];
                
                const sections = content.split('###').filter(section => section.trim());
                
                for (const section of sections) {
                    const lines = section.split('\n').filter(line => line.trim());
                    if (lines.length === 0) continue;
                    
                    const name = lines[0].trim();
                    let model = '', baseUrl = '', apiKey = '';
                    
                    for (const line of lines.slice(1)) {
                        const trimmedLine = line.trim();
                        if (trimmedLine.startsWith('model=')) {
                            model = trimmedLine.replace('model=', '').replace(/"/g, '');
                        } else if (trimmedLine.startsWith('base_url=')) {
                            baseUrl = trimmedLine.replace('base_url=', '').replace(/"/g, '');
                        } else if (trimmedLine.startsWith('api_key')) {
                            apiKey = trimmedLine.replace(/api_key\s*=\s*/, '').replace(/"/g, '');
                        }
                    }
                    
                    if (name && model && baseUrl && apiKey) {
                        models.push({ name, model, baseUrl, apiKey });
                    }
                }
                
                availableModels = models;
                displayModels();
                
            } catch (error) {
                document.getElementById('models-list').innerHTML = 
                    `<div class="status error">è¼‰å…¥AIæ¨¡å‹é…ç½®å¤±æ•—: ${error.message}</div>`;
            }
        }

        // é¡¯ç¤ºæ¨¡å‹åˆ—è¡¨
        function displayModels() {
            const container = document.getElementById('models-list');
            if (availableModels.length === 0) {
                container.innerHTML = '<div class="status warning">æ²’æœ‰æ‰¾åˆ°å¯ç”¨çš„AIæ¨¡å‹</div>';
                return;
            }

            let html = '';
            availableModels.forEach(model => {
                html += `
                    <div style="margin: 10px 0; padding: 10px; background-color: #3a3a3a; border-radius: 5px;">
                        <strong>${model.name}</strong> - ${model.model}
                        <br>
                        <button onclick="testSingleModel('${model.name}')" id="btn-${model.name}">
                            æ¸¬è©¦ ${model.name}
                        </button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // æ¸¬è©¦å–®ä¸€æ¨¡å‹
        async function testSingleModel(modelName) {
            if (isTestingInProgress) {
                addResult('warning', 'å·²æœ‰æ¸¬è©¦åœ¨é€²è¡Œä¸­ï¼Œè«‹ç­‰å¾…å®Œæˆ');
                return;
            }

            const button = document.getElementById(`btn-${modelName}`);
            button.disabled = true;
            button.textContent = `æ¸¬è©¦ä¸­... ${modelName}`;
            
            addResult('info', `ğŸ§ª é–‹å§‹æ¸¬è©¦ ${modelName}...`);

            try {
                isTestingInProgress = true;
                
                // é€™è£¡éœ€è¦èª¿ç”¨å¯¦éš›çš„AIæœå‹™
                // ç”±æ–¼æˆ‘å€‘åœ¨HTMLç’°å¢ƒä¸­ï¼Œéœ€è¦æ¨¡æ“¬æˆ–é€šéå…¶ä»–æ–¹å¼èª¿ç”¨
                addResult('warning', `${modelName} æ¸¬è©¦åŠŸèƒ½éœ€è¦åœ¨ä¸»æ‡‰ç”¨ç¨‹å¼ä¸­åŸ·è¡Œ`);
                addResult('info', `è«‹åœ¨ä¸»æ‡‰ç”¨ç¨‹å¼çš„ã€ŒAIå»ºè­°è‡ªå‹•æ’ç¨‹ã€å€å¡Šä¸­é»æ“Šã€Œæ¸¬è©¦ ${modelName}ã€æŒ‰éˆ•`);
                
            } catch (error) {
                addResult('error', `${modelName} æ¸¬è©¦å¤±æ•—: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = `æ¸¬è©¦ ${modelName}`;
                isTestingInProgress = false;
            }
        }

        // ä¾åºæ¸¬è©¦æ‰€æœ‰æ¨¡å‹
        async function testAllModelsSequentially() {
            if (isTestingInProgress) {
                addResult('warning', 'å·²æœ‰æ¸¬è©¦åœ¨é€²è¡Œä¸­ï¼Œè«‹ç­‰å¾…å®Œæˆ');
                return;
            }

            addResult('info', 'ğŸš€ é–‹å§‹ä¾åºæ¸¬è©¦æ‰€æœ‰AIæ¨¡å‹...');
            addResult('warning', 'âš ï¸ ç”±æ–¼é€Ÿç‡é™åˆ¶ï¼Œæ¯å€‹æ¨¡å‹ä¹‹é–“æœƒç­‰å¾…10ç§’');
            
            for (let i = 0; i < availableModels.length; i++) {
                const model = availableModels[i];
                addResult('info', `ğŸ“‹ ç¬¬ ${i + 1}/${availableModels.length} å€‹æ¨¡å‹: ${model.name}`);
                
                await testSingleModel(model.name);
                
                // åœ¨æ¨¡å‹ä¹‹é–“ç­‰å¾…
                if (i < availableModels.length - 1) {
                    addResult('info', 'â³ ç­‰å¾…10ç§’å¾Œæ¸¬è©¦ä¸‹ä¸€å€‹æ¨¡å‹...');
                    await new Promise(resolve => setTimeout(resolve, 10000));
                }
            }
            
            addResult('success', 'âœ… æ‰€æœ‰æ¨¡å‹æ¸¬è©¦å®Œæˆ');
        }

        // æ·»åŠ çµæœ
        function addResult(type, message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString('zh-TW');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `[${timestamp}] ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        // æ¸…é™¤çµæœ
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.onload = function() {
            loadAIModels();
            addResult('info', 'ğŸ¯ å–®ä¸€AIæ¨¡å‹æ¸¬è©¦å·¥å…·å·²è¼‰å…¥');
            addResult('warning', 'âš ï¸ å¯¦éš›æ¸¬è©¦éœ€è¦åœ¨ä¸»æ‡‰ç”¨ç¨‹å¼ä¸­åŸ·è¡Œ');
        };
    </script>
</body>
</html>
