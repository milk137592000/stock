# 每日AI建議自動排程功能

## 🎯 **功能概述**

每天早上10點自動執行app，使用4種AI模型生成投資建議，並將有實際買/賣建議的股票記錄到 `advice.md` 文件中。

## ✅ **功能特點**

### 1. **自動排程執行**
- **執行時間**: 每天早上10:00
- **自動觸發**: 無需手動操作
- **智能檢測**: 如果在10:00-10:05之間啟動，立即執行一次

### 2. **多AI模型支援**
- **deepseek**: DeepSeek AI模型
- **Mistral**: Mistral AI模型  
- **Gemini**: Google Gemini模型
- **Meta**: Meta Llama模型

### 3. **智能過濾記錄**
- **只記錄有動作的建議**: 過濾掉HOLD建議
- **現有持股**: 只記錄BUY/SELL建議
- **新股建議**: 記錄所有新股推薦
- **自動備份**: 每次更新前自動備份advice.md

### 4. **自動資料更新**
- **最新股價**: 自動爬取Yahoo股市最新價格
- **持股同步**: 自動讀取warehouse.md持股資料
- **即時計算**: 基於最新資料生成建議

## 🔧 **技術架構**

### 核心服務

#### 1. **SchedulerService** (排程服務)
```typescript
// 啟動每日10點排程
SchedulerService.start();

// 手動執行一次
SchedulerService.executeNow();

// 測試模式（每2分鐘執行）
SchedulerService.startTestMode(2);
```

#### 2. **MultiAIAdviceService** (多AI建議服務)
```typescript
// 生成所有AI模型建議
const result = await MultiAIAdviceService.generateAndRecordAllAdvice();

// 測試單一模型
const success = await MultiAIAdviceService.testSingleModel('deepseek');
```

#### 3. **AdviceRecordService** (建議記錄服務)
```typescript
// 記錄AI建議
const success = await AdviceRecordService.recordAdvice(modelName, advice);

// 清理30天前的舊記錄
await AdviceRecordService.cleanupOldRecords();
```

### 資料流程

```
定時觸發 → 載入最新持股 → 更新股價 → 生成AI建議 → 過濾有效建議 → 記錄到advice.md
    ↓           ↓            ↓         ↓           ↓             ↓
  每日10點   warehouse.md   Yahoo爬蟲   4種AI模型   只記錄BUY/SELL   自動備份
```

## 📁 **advice.md 文件格式**

### 記錄結構
```markdown
## 2025/06/16（週一） - deepseek

### 📊 市場展望
當前台股呈現震盪整理，建議謹慎操作。科技股相對強勢，建議適度加碼優質標的。

### 💰 預算摘要
- **AI判斷投資金額**: NT$ 5,456 (範圍: 1,000-20,000)
- **實際分配金額**: NT$ 24,285

### 🔄 持有股票建議
- 📉 **00733 (富邦臺灣中小)**: 賣出 241 股
  - 現價: NT$ 39.02
  - 金額: NT$ 9,404
  - 理由: 產業景氣轉弱，建議減碼

- 📈 **00900 (富邦特選高股息30)**: 買入 66 股
  - 現價: NT$ 13.18
  - 金額: NT$ 870
  - 理由: 技術面突破關鍵阻力位，建議加碼

### 🆕 建議購入新股
- 📈 **2330 (台積電)**: 買入 50 股
  - 現價: NT$ 945.00
  - 金額: NT$ 47,250
  - 理由: 產業龍頭地位穩固，適合長期投資

---
```

### 過濾規則
- ✅ **記錄**: 持有股票的BUY/SELL建議
- ❌ **不記錄**: HOLD建議
- ✅ **記錄**: 未在持有股中的建議購入股票
- ✅ **記錄**: 市場展望和AI判斷的投資金額

### 投資策略設定
- **策略類型**: 穩健型長期投資
- **目標報酬率**: 年化5%以上
- **投資金額範圍**: 1,000-20,000 NTD
- **AI模型焦點**:
  - deepseek (股息穩定): 8,000-12,000 - 高股息ETF和穩定配息
  - Mistral (平衡成長): 10,000-15,000 - 大型ETF和績優股
  - Gemini (優質企業): 12,000-16,000 - 龍頭企業和指數基金
  - Meta (長期價值): 9,000-15,000 - 價值投資和股息成長

## 🎮 **使用方式**

### 1. **啟動排程**
在app中找到「AI建議自動排程」區塊，點擊「啟動排程」按鈕。

### 2. **查看狀態**
- **排程狀態**: 顯示是否已啟動
- **執行狀態**: 顯示是否正在執行
- **下次執行時間**: 顯示下次10點執行的時間

### 3. **手動執行**
點擊「立即執行一次」按鈕可以手動觸發AI建議生成。

### 4. **測試功能**
- **測試單一模型**: 測試特定AI模型
- **測試模式**: 每2分鐘執行一次，用於測試

## 🛡️ **安全機制**

### 1. **防重複執行**
- 同時只能有一個AI建議生成任務運行
- 如果已在執行中，跳過新的觸發

### 2. **錯誤處理**
- AI模型失敗時繼續處理其他模型
- 記錄詳細的成功/失敗狀態
- 自動重試機制

### 3. **資料備份**
- 每次更新advice.md前自動備份
- 備份文件命名: `advice.backup.YYYY-MM-DDTHH-mm-ss-sssZ.md`

### 4. **舊記錄清理**
- 自動清理30天前的記錄
- 保持文件大小合理

## 📊 **監控和日誌**

### 控制台輸出
```
🚀 啟動AI建議自動排程服務...
⏰ 下次AI建議生成時間: 2025/6/17 上午10:00:00
🕙 開始執行每日AI建議生成任務...
🤖 使用 deepseek 生成投資建議...
✅ deepseek 建議已記錄到 advice.md
🎯 多AI建議生成完成: 4/4 成功
```

### 狀態顯示
- **成功計數**: 顯示成功生成建議的模型數量
- **失敗詳情**: 顯示失敗模型和錯誤原因
- **執行時間**: 記錄每次執行的時間

## 🔄 **工作流程**

### 每日自動執行流程
1. **10:00觸發** → 檢查是否已在執行中
2. **載入資料** → 讀取warehouse.md持股資料
3. **更新股價** → 爬取Yahoo最新股市價格
4. **生成建議** → 依序使用4種AI模型
5. **過濾記錄** → 只記錄有BUY/SELL建議的股票
6. **更新文件** → 寫入advice.md並備份
7. **清理舊記錄** → 刪除30天前的記錄
8. **排程下次** → 設定明天10點執行

### 手動執行流程
1. **點擊按鈕** → 立即觸發執行
2. **執行相同流程** → 與自動執行相同
3. **顯示結果** → 在界面顯示執行結果

## 🎯 **預期效果**

### 每日產出
- **4份AI建議**: 每種模型一份建議
- **過濾後記錄**: 只記錄有實際操作價值的建議
- **結構化資料**: 便於查閱和分析的格式

### 長期累積
- **歷史趨勢**: 可以分析AI建議的歷史趨勢
- **模型比較**: 比較不同AI模型的建議差異
- **投資參考**: 作為投資決策的重要參考

這個功能確保您每天都能獲得最新的AI投資建議，並且只記錄真正有價值的買賣建議！
