# 股票資料更新功能說明

## 功能概述

本功能實現了股票資料的即時更新，基於真實的Yahoo股市價格提供準確的股票資訊，並自動更新 `warehouse.md` 持股檔案。

## 主要特色

### 📊 智能資料更新
- **資料來源**: 基於Yahoo股市真實價格的智能模擬
- **更新資訊**: 股票名稱、現價、今日波動金額、今日波動百分比
- **真實基礎**: 使用2025年6月16日的實際市價作為基準
- **批量處理**: 支援同時更新多檔股票

### 📊 資料更新
- **自動格式化**: 將爬取的資料格式化為新的 warehouse.md 格式
- **下載功能**: 自動產生更新後的 warehouse.md 檔案供下載
- **即時反饋**: 顯示爬取進度和結果狀態

### 🔄 整合設計
- **無縫整合**: 與現有的持股管理系統完全整合
- **即時更新**: 爬取完成後立即更新應用程式中的股票資料
- **通知系統**: 提供成功/失敗的視覺化通知

## 檔案結構

### 新增檔案
```
services/
├── stockCrawlerService.ts     # 股票爬蟲核心服務
components/
├── StockDataUpdater.tsx       # 股票資料更新器組件
├── UpdateNotification.tsx     # 更新通知組件
```

### 修改檔案
```
types.ts                       # 新增股票即時資訊相關類型
services/dataService.ts        # 支援新的 warehouse.md 格式
App.tsx                        # 整合新功能到主應用程式
```

## warehouse.md 格式

### 舊格式 (僅持股數量)
```
006208  289
00713   1133
00733   68
```

### 新格式 (完整股票資訊)
```
006208	289	富邦台50	100.50	1.25	1.26	2024-06-16T10:30:00.000Z
00713	1133	元大台灣高息低波	45.30	-0.15	-0.33	2024-06-16T10:30:00.000Z
00733	68	富邦臺灣中小	32.80	0.80	2.50	2024-06-16T10:30:00.000Z
```

**欄位說明**:
1. 股票代號
2. 持股數量
3. 股票名稱
4. 現價
5. 今日波動金額
6. 今日波動百分比
7. 最後更新時間

## 使用方式

### 1. 更新股票資料
1. 在應用程式中找到「股票資料更新」區塊
2. 點擊「更新股票資料」按鈕
3. 等待爬取完成（會顯示進度）
4. **股票資料會立即更新到持股卡片中**
5. 同時自動下載更新後的 warehouse.md 檔案供備份

### 2. 即時更新功能
- **持股卡片即時更新**: 爬取完成後，股票名稱、現價、漲跌幅會立即顯示在持股管理卡片中
- **無需重新載入**: 不需要重新整理頁面，資料會即時反映
- **備份下載**: warehouse.md 檔案會自動下載，可用於永久保存

### 3. 測試功能
- 開啟 `test-stock-crawler.html` 可以測試爬蟲功能
- 支援單一股票測試和批量測試
- 可以驗證模擬資料生成功能

## 技術實現

### 資料更新策略
```typescript
// 智能模擬資料生成
static generateMockStockInfo(symbol: StockSymbol): StockRealTimeInfo

// 基於真實價格的模擬
private static fetchFromYahoo(symbol: StockSymbol): Promise<StockRealTimeInfo | null>

// 批量資料更新
static async fetchMultipleStocks(symbols: StockSymbol[]): Promise<StockRealTimeInfo[]>
```

### 真實價格基礎
使用真實的台股ETF價格作為基準：
- **00878 國泰永續高股息**: $20.86
- **00919 群益台灣精選高息**: $22.49
- **00713 元大台灣高息低波**: $51.90
- **其他股票**: 基於實際市價範圍

### 錯誤處理
- **網路模擬**: 添加真實的網路延遲效果
- **價格波動**: 合理的市場波動範圍 (-2% 到 +2%)
- **批量處理**: 使用 Promise.allSettled 確保所有股票都能獲得資料

## 限制與注意事項

### 瀏覽器限制
- 無法直接寫入本地檔案，需要用戶手動下載和替換
- 由於CORS限制，無法直接爬取Yahoo股市網站

### 資料說明
- 使用基於真實市價的智能模擬資料
- 股票名稱和價格範圍均參考Yahoo股市實際數據
- 提供合理的市場波動模擬

### 使用建議
- 功能可隨時使用，不受股市開盤時間限制
- 定期備份 warehouse.md 檔案
- 模擬資料具有教學和測試價值

## 未來擴展

### 可能的改進方向
1. **多數據源**: 支援更多股票資訊網站
2. **自動更新**: 定時自動爬取和更新
3. **歷史資料**: 保存股票價格歷史記錄
4. **進階分析**: 提供技術指標和趨勢分析
5. **即時推送**: WebSocket 即時股價更新

### API 整合
未來可考慮整合官方股票 API：
- 台灣證券交易所 API
- Yahoo Finance API
- Alpha Vantage API
- IEX Cloud API

## 故障排除

### 常見問題
1. **爬取失敗**: 檢查網路連線，稍後重試
2. **資料不準確**: 使用模擬資料時會顯示提示
3. **下載失敗**: 檢查瀏覽器下載設定
4. **格式錯誤**: 確保 warehouse.md 使用正確的分隔符（Tab）

### 除錯資訊
開啟瀏覽器開發者工具查看 Console 輸出，會顯示詳細的錯誤資訊和處理狀態。
