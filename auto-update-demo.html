<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå‹•æ›´æ–°åŠŸèƒ½æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1e293b;
            color: #e2e8f0;
        }
        .hero {
            text-align: center;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
        }
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .status-card {
            background-color: #334155;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #475569;
        }
        .status-card.success {
            border-color: #10b981;
            background-color: #065f46;
        }
        .status-card.warning {
            border-color: #f59e0b;
            background-color: #7c2d12;
        }
        .status-card.error {
            border-color: #ef4444;
            background-color: #7f1d1d;
        }
        .status-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .status-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status-desc {
            color: #94a3b8;
            line-height: 1.5;
        }
        .demo-section {
            background-color: #334155;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        .demo-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #3b82f6;
        }
        .step-list {
            list-style: none;
            padding: 0;
        }
        .step-list li {
            background-color: #475569;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .step-list li.completed {
            border-left-color: #10b981;
            background-color: #065f46;
        }
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s;
        }
        button:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        button:disabled {
            background-color: #64748b;
            cursor: not-allowed;
            transform: none;
        }
        .highlight {
            background-color: #fbbf24;
            color: #1f2937;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        .code-block {
            background-color: #1e293b;
            border: 1px solid #475569;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>ğŸš€ Warehouse.md è‡ªå‹•æ›´æ–°</h1>
        <p>çœŸæ­£çš„è‡ªå‹•æ›´æ–° - ç„¡éœ€æ‰‹å‹•ä¸‹è¼‰å’Œè¦†è“‹ï¼</p>
    </div>

    <div class="status-grid">
        <div class="status-card" id="service-status">
            <div class="status-icon">â³</div>
            <div class="status-title">å¾Œç«¯æœå‹™ç‹€æ…‹</div>
            <div class="status-desc">æª¢æŸ¥ä¸­...</div>
        </div>
        
        <div class="status-card" id="warehouse-status">
            <div class="status-icon">ğŸ“</div>
            <div class="status-title">Warehouse.md ç‹€æ…‹</div>
            <div class="status-desc">æª¢æŸ¥ä¸­...</div>
        </div>
        
        <div class="status-card" id="update-status">
            <div class="status-icon">ğŸ”„</div>
            <div class="status-title">è‡ªå‹•æ›´æ–°ç‹€æ…‹</div>
            <div class="status-desc">å¾…æª¢æŸ¥</div>
        </div>
    </div>

    <div class="demo-section">
        <div class="demo-title">ğŸ¯ è‡ªå‹•æ›´æ–°æµç¨‹</div>
        <ol class="step-list">
            <li id="step1">âœ… è®€å– warehouse.md - æª¢æ¸¬ä¸å®Œæ•´çš„è‚¡ç¥¨è³‡æ–™</li>
            <li id="step2">ğŸ•·ï¸ çˆ¬èŸ²æœ€æ–°è³‡è¨Š - ç²å–å®Œæ•´çš„è‚¡ç¥¨è³‡è¨Š</li>
            <li id="step3">ğŸ“ ç”Ÿæˆæ›´æ–°å…§å®¹ - æ ¼å¼åŒ–ç‚ºå®Œæ•´çš„ warehouse.md</li>
            <li id="step4">ğŸš€ è‡ªå‹•æ›´æ–°æª”æ¡ˆ - ç›´æ¥æ›´æ–° warehouse.md (ç„¡éœ€æ‰‹å‹•æ“ä½œ)</li>
            <li id="step5">ğŸ”„ è‡ªå‹•é‡æ–°è¼‰å…¥ - 3ç§’å¾Œè‡ªå‹•åˆ·æ–°é é¢</li>
            <li id="step6">âœ¨ å®ŒæˆåŒæ­¥ - é¡¯ç¤ºæœ€æ–°çš„è‚¡ç¥¨è³‡è¨Š</li>
        </ol>
    </div>

    <div class="demo-section">
        <div class="demo-title">ğŸ“‹ ç•¶å‰ Warehouse.md ç‹€æ…‹</div>
        <p>æª¢æ¸¬åˆ°æ–°å¢è‚¡ç¥¨: <span class="highlight">00921</span></p>
        <div class="code-block" id="current-warehouse">è¼‰å…¥ä¸­...</div>
    </div>

    <div style="text-align: center; margin: 30px 0;">
        <button onclick="checkStatus()" id="check-btn">ğŸ” æª¢æŸ¥ç‹€æ…‹</button>
        <button onclick="testAutoUpdate()" id="test-btn" disabled>ğŸš€ æ¸¬è©¦è‡ªå‹•æ›´æ–°</button>
        <button onclick="openMainApp()">ğŸ“± æ‰“é–‹ä¸»æ‡‰ç”¨ç¨‹å¼</button>
    </div>

    <div class="demo-section" id="result-section" style="display: none;">
        <div class="demo-title">ğŸ“Š æ¸¬è©¦çµæœ</div>
        <div id="test-results"></div>
    </div>

    <script>
        let serviceAvailable = false;

        async function checkStatus() {
            const serviceCard = document.getElementById('service-status');
            const warehouseCard = document.getElementById('warehouse-status');
            const updateCard = document.getElementById('update-status');
            const checkBtn = document.getElementById('check-btn');
            const testBtn = document.getElementById('test-btn');

            checkBtn.disabled = true;
            checkBtn.textContent = 'æª¢æŸ¥ä¸­...';

            try {
                // æª¢æŸ¥å¾Œç«¯æœå‹™
                const healthResponse = await fetch('http://localhost:3001/api/health');
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    serviceCard.className = 'status-card success';
                    serviceCard.querySelector('.status-icon').textContent = 'âœ…';
                    serviceCard.querySelector('.status-desc').textContent = 'æœå‹™é‹è¡Œæ­£å¸¸ - æ”¯æ´è‡ªå‹•æ›´æ–°';
                    serviceAvailable = true;
                } else {
                    throw new Error('æœå‹™éŸ¿æ‡‰ç•°å¸¸');
                }

                // æª¢æŸ¥ warehouse.md
                const warehouseResponse = await fetch('http://localhost:3001/api/warehouse');
                if (warehouseResponse.ok) {
                    const warehouseData = await warehouseResponse.json();
                    warehouseCard.className = 'status-card success';
                    warehouseCard.querySelector('.status-icon').textContent = 'ğŸ“';
                    warehouseCard.querySelector('.status-desc').textContent = 'æª”æ¡ˆè®€å–æ­£å¸¸';
                    
                    // é¡¯ç¤ºç•¶å‰å…§å®¹
                    document.getElementById('current-warehouse').textContent = warehouseData.content;
                    
                    // æª¢æŸ¥æ˜¯å¦æœ‰ä¸å®Œæ•´çš„è‚¡ç¥¨
                    const lines = warehouseData.content.split('\n').filter(line => line.trim());
                    const incompleteStocks = lines.filter(line => {
                        const parts = line.trim().split(/\t/);
                        return parts.length < 4 || !parts[2] || !parts[3];
                    });

                    if (incompleteStocks.length > 0) {
                        updateCard.className = 'status-card warning';
                        updateCard.querySelector('.status-icon').textContent = 'âš ï¸';
                        updateCard.querySelector('.status-desc').textContent = `ç™¼ç¾ ${incompleteStocks.length} æª”è‚¡ç¥¨éœ€è¦æ›´æ–°`;
                        testBtn.disabled = false;
                    } else {
                        updateCard.className = 'status-card success';
                        updateCard.querySelector('.status-icon').textContent = 'âœ…';
                        updateCard.querySelector('.status-desc').textContent = 'æ‰€æœ‰è‚¡ç¥¨è³‡æ–™å®Œæ•´';
                    }
                } else {
                    throw new Error('ç„¡æ³•è®€å– warehouse.md');
                }

            } catch (error) {
                console.error('æª¢æŸ¥å¤±æ•—:', error);
                
                if (!serviceAvailable) {
                    serviceCard.className = 'status-card error';
                    serviceCard.querySelector('.status-icon').textContent = 'âŒ';
                    serviceCard.querySelector('.status-desc').textContent = 'æœå‹™æœªé‹è¡Œ - è«‹å•Ÿå‹•å¾Œç«¯æœå‹™';
                }
                
                warehouseCard.className = 'status-card error';
                warehouseCard.querySelector('.status-icon').textContent = 'âŒ';
                warehouseCard.querySelector('.status-desc').textContent = 'æª”æ¡ˆè®€å–å¤±æ•—';
                
                updateCard.className = 'status-card error';
                updateCard.querySelector('.status-icon').textContent = 'âŒ';
                updateCard.querySelector('.status-desc').textContent = 'ç„¡æ³•æª¢æŸ¥æ›´æ–°ç‹€æ…‹';
            } finally {
                checkBtn.disabled = false;
                checkBtn.textContent = 'ğŸ” æª¢æŸ¥ç‹€æ…‹';
            }
        }

        async function testAutoUpdate() {
            const resultSection = document.getElementById('result-section');
            const testResults = document.getElementById('test-results');
            const testBtn = document.getElementById('test-btn');

            testBtn.disabled = true;
            testBtn.textContent = 'æ¸¬è©¦ä¸­...';
            
            resultSection.style.display = 'block';
            testResults.innerHTML = '<div class="code-block">ğŸš€ é–‹å§‹æ¸¬è©¦è‡ªå‹•æ›´æ–°...</div>';

            try {
                // æ¨¡æ“¬æ›´æ–°å…§å®¹
                const mockContent = `006208	289	å¯Œé‚¦å°50	110.25	0.35	0.32	2025-06-16T19:45:00.000Z
00713	1133	å…ƒå¤§å°ç£é«˜æ¯ä½æ³¢	51.90	0.10	0.19	2025-06-16T19:45:00.000Z
00878	1572	åœ‹æ³°æ°¸çºŒé«˜è‚¡æ¯	20.86	0.02	0.10	2025-06-16T19:45:00.000Z
00921	222	å…†è±é¾é ­ç­‰æ¬Šé‡	18.50	0.25	1.37	2025-06-16T19:45:00.000Z`;

                const updateResponse = await fetch('http://localhost:3001/api/warehouse/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: mockContent }),
                });

                if (updateResponse.ok) {
                    const updateData = await updateResponse.json();
                    testResults.innerHTML = `
                        <div class="code-block" style="border-left: 4px solid #10b981;">
                            âœ… è‡ªå‹•æ›´æ–°æˆåŠŸï¼<br>
                            ğŸ“ æª”æ¡ˆå·²æ›´æ–°: warehouse.md<br>
                            ğŸ’¾ å‚™ä»½æª”æ¡ˆ: ${updateData.backupPath}<br>
                            ğŸ‰ 00921 å·²ç²å¾—å®Œæ•´è³‡è¨Š: å…†è±é¾é ­ç­‰æ¬Šé‡ $18.50
                        </div>
                        <div style="margin-top: 15px;">
                            <button onclick="window.location.reload()" style="background-color: #10b981;">
                                ğŸ”„ é‡æ–°è¼‰å…¥é é¢æŸ¥çœ‹çµæœ
                            </button>
                        </div>
                    `;
                    
                    // æ¨™è¨˜æ­¥é©Ÿå®Œæˆ
                    for (let i = 1; i <= 6; i++) {
                        setTimeout(() => {
                            document.getElementById(`step${i}`).classList.add('completed');
                        }, i * 500);
                    }
                } else {
                    throw new Error('æ›´æ–°è«‹æ±‚å¤±æ•—');
                }

            } catch (error) {
                console.error('æ¸¬è©¦å¤±æ•—:', error);
                testResults.innerHTML = `
                    <div class="code-block" style="border-left: 4px solid #ef4444;">
                        âŒ è‡ªå‹•æ›´æ–°å¤±æ•—: ${error.message}<br>
                        è«‹æª¢æŸ¥å¾Œç«¯æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œ
                    </div>
                `;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'ğŸš€ æ¸¬è©¦è‡ªå‹•æ›´æ–°';
            }
        }

        function openMainApp() {
            window.open('http://localhost:5173/', '_blank');
        }

        // è‡ªå‹•æª¢æŸ¥ç‹€æ…‹
        setTimeout(checkStatus, 1000);
    </script>
</body>
</html>
