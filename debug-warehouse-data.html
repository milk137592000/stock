<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª¿è©¦ Warehouse è³‡æ–™</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1e293b;
            color: #e2e8f0;
        }
        .section {
            background-color: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .title {
            font-size: 18px;
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 10px;
        }
        .data-row {
            background-color: #475569;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #2563eb;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .diff {
            background-color: #dc2626;
            color: white;
            padding: 2px 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Warehouse è³‡æ–™èª¿è©¦</h1>
    
    <button onclick="debugWarehouseData()">ğŸ” èª¿è©¦ warehouse.md è®€å–</button>
    <button onclick="compareData()">âš–ï¸ æ¯”è¼ƒè³‡æ–™å·®ç•°</button>
    <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤çµæœ</button>
    
    <div id="results"></div>

    <script type="module">
        // æ¨¡æ“¬ loadDetailedHoldingsFromWarehouse å‡½æ•¸
        const loadDetailedHoldingsFromWarehouse = async () => {
            try {
                const response = await fetch('/warehouse.md');
                if (!response.ok) {
                    throw new Error(`ç„¡æ³•è®€å– warehouse.md: ${response.status}`);
                }

                const content = await response.text();
                const holdings = [];

                console.log('åŸå§‹ warehouse.md å…§å®¹:');
                console.log(content);

                // è§£ææ¯ä¸€è¡Œçš„æŒè‚¡è³‡æ–™
                const lines = content.split('\n').filter(line => line.trim());

                for (const line of lines) {
                    const parts = line.trim().split(/\t/); // ä½¿ç”¨tabåˆ†éš”

                    if (parts.length >= 2) {
                        const symbol = parts[0];
                        const shares = parseInt(parts[1], 10);

                        if (!isNaN(shares) && shares > 0) {
                            const holding = {
                                symbol,
                                shares,
                                name: parts[2] || symbol,
                                currentPrice: parts[3] ? parseFloat(parts[3]) : undefined,
                                change: parts[4] ? parseFloat(parts[4]) : undefined,
                                changePercent: parts[5] ? parseFloat(parts[5]) : undefined,
                                lastUpdated: parts[6] || undefined
                            };
                            holdings.push(holding);
                        }
                    }
                }

                return holdings;
            } catch (error) {
                console.error('è®€å–è©³ç´°æŒè‚¡è³‡æ–™å¤±æ•—:', error);
                return [];
            }
        };

        window.debugWarehouseData = async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="warning">æ­£åœ¨èª¿è©¦ warehouse.md è³‡æ–™...</div>';

            try {
                // 1. è®€å–åŸå§‹æª”æ¡ˆå…§å®¹
                const response = await fetch('/warehouse.md');
                const rawContent = await response.text();
                
                // 2. ä½¿ç”¨è§£æå‡½æ•¸
                const parsedData = await loadDetailedHoldingsFromWarehouse();

                let html = `
                    <div class="section">
                        <div class="title">ğŸ“„ åŸå§‹ warehouse.md å…§å®¹</div>
                        <div class="data-row">${rawContent.replace(/\n/g, '<br>')}</div>
                    </div>

                    <div class="section">
                        <div class="title">ğŸ“Š è§£æå¾Œçš„è³‡æ–™ (${parsedData.length} æª”è‚¡ç¥¨)</div>
                `;

                parsedData.forEach((stock, index) => {
                    html += `
                        <div class="data-row">
                            <strong>${index + 1}. ${stock.symbol} - ${stock.name}</strong><br>
                            æŒè‚¡: ${stock.shares} è‚¡<br>
                            ç¾åƒ¹: $${stock.currentPrice || 'N/A'}<br>
                            æ¼²è·Œ: ${stock.change || 'N/A'} (${stock.changePercent || 'N/A'}%)<br>
                            æ›´æ–°æ™‚é–“: ${stock.lastUpdated || 'N/A'}
                        </div>
                    `;
                });

                html += '</div>';

                // 3. æª¢æŸ¥æ‡‰è©²åœ¨å¡ç‰‡ä¸­é¡¯ç¤ºçš„è³‡æ–™
                html += `
                    <div class="section">
                        <div class="title">ğŸ¯ æ‡‰è©²åœ¨å¡ç‰‡ä¸­é¡¯ç¤ºçš„ç¾åƒ¹</div>
                `;

                parsedData.forEach(stock => {
                    html += `
                        <div class="data-row">
                            ${stock.symbol}: <strong style="color: #3b82f6;">$${stock.currentPrice}</strong>
                        </div>
                    `;
                });

                html += '</div>';

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">âŒ éŒ¯èª¤: ${error.message}</div>`;
            }
        };

        window.compareData = async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="warning">æ­£åœ¨æ¯”è¼ƒè³‡æ–™...</div>';

            try {
                // warehouse.md ä¸­çš„è³‡æ–™
                const warehouseData = await loadDetailedHoldingsFromWarehouse();
                
                // é æœŸçš„å¡ç‰‡è³‡æ–™ (åŸºæ–¼ warehouse.md)
                const expectedCardData = {};
                warehouseData.forEach(stock => {
                    expectedCardData[stock.symbol] = {
                        name: stock.name,
                        currentPrice: stock.currentPrice,
                        shares: stock.shares
                    };
                });

                let html = `
                    <div class="comparison">
                        <div class="section">
                            <div class="title">ğŸ“„ Warehouse.md è³‡æ–™</div>
                `;

                warehouseData.forEach(stock => {
                    html += `
                        <div class="data-row">
                            <strong>${stock.symbol}</strong><br>
                            åç¨±: ${stock.name}<br>
                            ç¾åƒ¹: <span style="color: #10b981;">$${stock.currentPrice}</span><br>
                            æŒè‚¡: ${stock.shares} è‚¡
                        </div>
                    `;
                });

                html += `
                        </div>
                        <div class="section">
                            <div class="title">ğŸ¯ å¡ç‰‡æ‡‰è©²é¡¯ç¤ºçš„è³‡æ–™</div>
                `;

                Object.keys(expectedCardData).forEach(symbol => {
                    const data = expectedCardData[symbol];
                    html += `
                        <div class="data-row">
                            <strong>${symbol}</strong><br>
                            åç¨±: ${data.name}<br>
                            ç¾åƒ¹: <span style="color: #3b82f6;">$${data.currentPrice}</span><br>
                            æŒè‚¡: ${data.shares} è‚¡
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>

                    <div class="section">
                        <div class="title">âš ï¸ å¦‚æœå¡ç‰‡è³‡æ–™ä¸ä¸€è‡´ï¼Œå¯èƒ½çš„åŸå› ï¼š</div>
                        <div class="data-row">
                            1. æ‡‰ç”¨ç¨‹å¼æ²’æœ‰é‡æ–°è®€å– warehouse.md<br>
                            2. loadDetailedHoldingsFromWarehouse() å‡½æ•¸æ²’æœ‰è¢«èª¿ç”¨<br>
                            3. ç‹€æ…‹æ›´æ–°å¤±æ•— (setCurrentAllStocksMap)<br>
                            4. å¿«å–å•é¡Œ - ç€è¦½å™¨ä½¿ç”¨äº†èˆŠçš„è³‡æ–™<br>
                            5. è‡ªå‹•æ›´æ–°è¦†è“‹äº† warehouse.md çš„è³‡æ–™
                        </div>
                    </div>

                    <div class="section">
                        <div class="title">ğŸ”§ å»ºè­°çš„ä¿®å¾©æ­¥é©Ÿï¼š</div>
                        <div class="data-row">
                            1. é‡æ–°è¼‰å…¥é é¢ (Ctrl+F5 å¼·åˆ¶é‡æ–°è¼‰å…¥)<br>
                            2. æª¢æŸ¥ç€è¦½å™¨ Console æ˜¯å¦æœ‰éŒ¯èª¤<br>
                            3. æ‰‹å‹•é»æ“Šã€Œæ›´æ–°è‚¡ç¥¨è³‡æ–™ã€æŒ‰éˆ•<br>
                            4. ç¢ºèª App.tsx ä½¿ç”¨ loadDetailedHoldingsFromWarehouse()
                        </div>
                    </div>
                `;

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">âŒ éŒ¯èª¤: ${error.message}</div>`;
            }
        };

        window.clearResults = () => {
            document.getElementById('results').innerHTML = '';
        };
    </script>
</body>
</html>
